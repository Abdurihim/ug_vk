// ug_vk.js (https://github.com/finalfantasia/ug_vk)
// The MIT License (MIT)
// Copyright (c) 2013, 2014 Abdussalam Abdurrahman (abdusalam.abdurahman@gmail.com)
!function(e){"use strict"
function t(e){return"function"==typeof e}function n(e){return"[object Array]"===Object.prototype.toString.call(e)}function a(e,t){var n
for(n=0;n<e.length;n++)if(e[n]===t)return n
return-1}function r(){L={a:"ھ",b:"ب",c:"غ",D:"ژ",d:"د",e:"ې",F:"ف",f:"ا",G:"گ",g:"ە",H:"خ",h:"ى",i:"ڭ",J:"ج",j:"ق",K:"ۆ",k:"ك",l:"ل",m:"م",n:"ن",o:"و",p:"پ",q:"چ",r:"ر",s:"س",t:"ت",u:"ۇ",v:"ۈ",w:"ۋ",x:"ش",y:"ي",z:"ز","/":"ئ",";":"؛","?":"؟",",":"،",_:"—","(":")",")":"(","[":"]","]":"[","{":"»","}":"«","<":"›",">":"‹"},C=[L.f,L.g,L.e,L.h,L.o,L.u,L.K,L.v],K=L["/"],_=[L[";"],L["?"],L[","]],S={},S.K=o,S.T=i,S.Y=i,O=!0}function o(e){var t,n=e.srcElement||e.target
for(x[n.name]="ug"===x[n.name]?"en":"ug",t=0;t<G.length;t++)G[t]({target:n,keyboardMode:x[n.name]})}function i(e){var t=e.srcElement||e.target
t.dir="ltr"===t.dir?"rtl":"ltr"}function l(e){var t=e.charCodeAt(0)
return t>=M&&A>t&&a(_,e)<0}function c(e){return l(e)&&a(C,e)>=0}function u(e,t){var n,a=t,r=e.selectionStart
return c(t)&&(0===r?a=K+t:(n=e.value[r-1],(!l(n)||c(n))&&(a=K+t))),a}function s(e,t){var n,a,r,o
"selection"in D&&"createRange"in D.selection?D.selection.createRange().text=t:(n=e.selectionStart,"textarea"===e.type&&e.scrollTop&&(r=e.scrollTop,o=e.scrollLeft),T.smartHamza&&(t=u(e,t)),e.value=e.value.slice(0,e.selectionStart)+t+e.value.slice(e.selectionEnd),r&&(e.scrollTop=r,e.scrollLeft=o),a=n+t.length,e.setSelectionRange(a,a))}function d(e,t,n){"addEventListener"in e?(e.removeEventListener(t,n,!1),e.addEventListener(t,n,!1)):(e.detachEvent("on"+t,n),e.attachEvent("on"+t,n))}function h(e,t,n){"removeEventListener"in e?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)}function f(e,t){function n(){h(e,"touchmove",a),h(e,"touchend",r),i=null,l=null,c=null,u=null}function a(e){var t
e.touches.length>1?n():(c=e.touches[0].pageX-i,t=e.touches[0].pageY-l,u&&0>u&&c>0||u>0&&0>c||Math.abs(t)>f?n():(u=c,e.preventDefault()))}function r(){var a=Math.abs(c)
n(),a>s&&t({target:e,direction:c>0?"RIGHT":"LEFT"})}function o(t){1===t.touches.length&&(i=t.touches[0].pageX,l=t.touches[0].pageY,d(e,"touchmove",a),d(e,"touchend",r))}var i,l,c,u,s=50,f=15
d(e,"touchstart",o)}function v(e){var t="which"in e?e.which:e.keyCode,n=String.fromCharCode(t).toUpperCase(),a=e.ctrlKey||e.metaKey
a&&n in S&&(S[n](e),"preventDefault"in e?(e.preventDefault(),e.stopPropagation()):(e.returnValue=!1,e.cancelBubble=!0))}function g(e){var t="target"in e?e.target:e.srcElement,n="which"in e?e.which:e.keyCode,a=String.fromCharCode(n),r=/^[A-Za-z]{1}$/.test(a),o=e.ctrlKey||e.metaKey,i=!1
o||"ug"!==x[t.name]||(a in L?("keyCode"in e&&!("which"in e)?e.keyCode=L[a].charCodeAt(0):s(t,L[a]),i=!0):r&&(e.returnValue=!1,i=!0)),i&&("preventDefault"in e?(e.preventDefault(),e.stopPropagation()):e.cancelBubble=!0)}function p(){var e,t,n,a=[]
for(e=D.getElementsByTagName("input"),t=D.getElementsByTagName("textarea"),n=0;n<e.length;n++)"text"===e[n].type.toLowerCase()&&a.push(e[n])
for(n=0;n<t.length;n++)a.push(t[n])
return a}function m(){var e,t,n
if(e=p(),T.all)for(n=0;n<e.length;n++)t=e[n],a(T.blacklist,t.name)<0&&(d(t,"keydown",v),d(t,"keypress",g),f(t,o),x[t.name]="ug")
else for(n=0;n<e.length;n++)t=e[n],a(T.whitelist,t.name)>=0&&(d(t,"keydown",v),d(t,"keypress",g),f(t,o),x[t.name]="ug")}function y(){var e,t,n
for(e=p(),n=0;n<e.length;n++)t=e[n],h(t,"keydown",v),h(t,"keypress",g)}function b(e){var t=":",n={}
return e.bedit_allow=e.bedit_allow||"",e.bedit_deny=e.bedit_deny||"",n.all=!!e.attachAll,n.smartHamza=!1,n.all?e.bedit_deny.length&&(n.blacklist=e.bedit_deny.split(t)):e.bedit_allow.length&&(n.whitelist=e.bedit_allow.split(t)),n}function w(e){var t
return e.smartHamza=!("smartHamza"in e&&!e.smartHamza),e.all=!!e.all,t=e.all?"blacklist"in e?n(e.blacklist):!0:n(e.whitelist)}function E(){var o={}
O||(o="object"==typeof e.UG_VK_OPTS?e.UG_VK_OPTS:b({attachAll:e.attachAll,bedit_allow:e.bedit_allow,bedit_deny:e.bedit_deny}),w(o)&&(T=o,r(),m()),e.UG_VK={addInputEventListeners:function(e){e&&(T={all:"all"in e?!!e.all:T.all,whitelist:n(e.whitelist)?e.whitelist:T.whitelist,blacklist:n(e.blacklist)?e.blacklist:T.blacklist}),O||r(),y(),m()},addKeyboardModeChangeListener:function(e){O&&t(e)&&a(G,e)<0&&G.push(e)}})}function k(t){function n(){i||(i=!0,t())}function a(){"removeEventListener"in D&&D.removeEventListener("DOMContentLoaded",a,!1),n()}function r(){if(!i){try{D.body.doScroll("up")}catch(e){return setTimeout(r,50),void 0}n()}}function o(){return"attachEvent"in D||"loading"===D.readyState?(l||(l=!0,"addEventListener"in D?(D.addEventListener("DOMContentLoaded",a,!1),e.addEventListener("load",a,!1)):(D.attachEvent("onload",a),r())),void 0):(n(),void 0)}var i=!1,l=!1
o()}var L,C,_,K,S,T,D=e.document,M=1536,A=1791,x={},G=[],O=!1
k(E)}(window)
